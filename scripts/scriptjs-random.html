<script>
    let selectedColumns = [];
    let fullData = []; // จะเก็บข้อมูลเต็มจาก fetch-realtime.php
    document.addEventListener("DOMContentLoaded", async () => {
        fetchAllDevice();
    });

    async function fetchAllDevice() {
        let response = await fetch("../config/fetch-realtime.php");
        let json = await response.json();
        fullData = json;
        GenerateOption('delete_select');
    }

    async function GenerateOption(id) {
        let select = document.getElementById(id);
        let option = document.createElement('option');
        option.value = "all";
        option.innerHTML = "-- All --";
        select.appendChild(option);

        const devices = [...new Set(fullData.map(d => d.name))];
        devices.forEach(column => {
            let option = document.createElement('option');
            option.value = column;
            option.innerHTML = column;
            select.appendChild(option);
        });
    }

    async function adddata(count_row) {
        let name = document.getElementById('name');
        let from = document.getElementById('form');
        let to = document.getElementById('to');
        let every = parseInt(document.getElementById('everytime').value);

        let namevalue = name.value;
        let formvalue = parseInt(from.value);
        let tovalue = parseInt(to.value);

        let temp = new Date();
        for (let i = 0; i < count_row; i++) {
            let formdata = new FormData();

            const createDate = temp.toISOString().slice(0, 19).replace("T", " ");

            // สุ่มตัวเลขในช่วงต่าง ๆ
            const randomNumber = (min, max) => (Math.random() * (max - min) + min).toFixed(2);

            // เพิ่มข้อมูลทั้งหมดใน FormData
            formdata.append('name', namevalue);
            formdata.append('create_date', createDate);
            formdata.append('Kw', randomNumber(formvalue, tovalue + 100));
            formdata.append('KwHr', randomNumber(formvalue, tovalue + 1000)/24);
            formdata.append('kVA', randomNumber(formvalue, tovalue + 100));
            formdata.append('kVAHr', randomNumber(formvalue, tovalue + 1000)/24);
            formdata.append('kVAR', randomNumber(formvalue, tovalue + 75));
            formdata.append('kVARHr', randomNumber(formvalue, tovalue + 5000)/24);
            formdata.append('Vch-P1', randomNumber(formvalue, tovalue + 250));
            formdata.append('Vch-P2', randomNumber(formvalue, tovalue + 250));
            formdata.append('Vch-P3', randomNumber(formvalue, tovalue + 250));
            formdata.append('Amp-L1', randomNumber(formvalue, tovalue + 100));
            formdata.append('Amp-L2', randomNumber(formvalue, tovalue + 100));
            formdata.append('Amp-L3', randomNumber(formvalue, tovalue + 100));
            formdata.append('Amp-N', randomNumber(formvalue, tovalue + 10));
            formdata.append('VoltageA_B', randomNumber(12, 24));
            formdata.append('VoltageB_C', randomNumber(12, 24));
            formdata.append('VoltageC_A', randomNumber(12, 24));
            formdata.append('Pf', randomNumber(0.8, 1.0));
            formdata.append('Frequency', randomNumber(30, 60));
            formdata.append('is_deleted', 0); // หรือ randomNumber(0, 1) ถ้าต้องการสุ่มสถานะ

            // ส่งข้อมูลไปยัง PHP
            let response = await fetch('../config/random-create.php', {
                method: 'POST',
                body: formdata
            })
            let json = await response.json();
            if (json.status) {
                
            }
            console.log(" :" + json.status ? json.message : json.message);

            // ➕ เพิ่มเวลา every นาทีให้ temp สำหรับรอบถัดไป
            temp = new Date(temp.getTime() + (every * 60 * 1000));
        }
    }

    async function deletedata() {
        let select = document.getElementById('delete_select').value;
        let formdata = new FormData();
        formdata.append('select', select); // หรือ randomNumber(0, 1) ถ้าต้องการสุ่มสถานะ
        let response = await fetch('../config/random-cleardata.php', {
            method: 'POST',
            body: formdata
        })
        let json = await response.json();
        
    }


</script>